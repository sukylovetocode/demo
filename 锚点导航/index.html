<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>锚点导航</title>
    <link rel="stylesheet" href="../library/reset.css">
    <style>
        .menu{
            position: fixed;
            width: 100%;
            top: 0;
        }
        .menu ul{
            width: 100%;
            background: chocolate;
            color: #fff;
            display: flex;
            height: 50px;
            justify-content: space-around;
            line-height: 50px;
        }
        .active{
            color: cornflowerblue;
        }
        .module{
            width: 100%;
            height: 800px;
            color: black;
            border: 1px solid blue;
            font-size: 30px;
            text-align: center;
            line-height: 800px;
            background: #ebebeb;
        }
    </style>
</head>
<body>

    <div class="menu">
        <ul>
            <li class="menu_item active"><a href="#module1">模块一</a></li>
            <li class="menu_item"><a href="#module2">模块二</a></li>
            <li class="menu_item"><a href="#module3">模块三</a></li>
            <li class="menu_item"><a href="#module4">模块四</a></li>
        </ul>
    </div>

    <div id="module1" class="module">模块一</div>
    <div id="module2" class="module">模块二</div>
    <div id="module3" class="module">模块三</div>
    <div id="module4" class="module">模块四</div>
    
    <script src="../library/jquery-3.5.1.js"></script>
    <script>
        (function(){

            // $('.menu_item a').click(function(e){
            //     let id = $(this).attr('href');
            //     let offsetTop = $(id).offset().top - 50;
            //     $('html').animate({scrollTop:offsetTop},1000);
            // });

            

            /* 选择有具体ID值的a标签 */
            $('a[href*="#"]:not([href="#"])').click(function () {
                /* 1 检测现在的路由地址与我点击的是否一致 2 检测锚点是否是我们页面中的 */
                if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
                    var $target = $(this.hash);
                    /* 这个元素是否存在，不存在则驱动name标签 */
                    $target = $target.length && $target || $('[name=' + this.hash.slice(1) + ']');
                    if ($target.length) {
                        var targetOffset = $target.offset().top;
                                $('html,body').animate({
                                    scrollTop: targetOffset
                                },
                            1000);
                    }
                     /* 元素添加类 */
                    // $('.menu_item').removeClass('active');
                    // $(this).parent().addClass('active');
                    return false;
                }
            });

            /* 滚动导航 */
            /* 获得滚动条高度的兼容性写法 */
            function scrollTop(){
                return document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
            }
            let offsetArr = [];
            function handleOffsetValue(){
                $('a[href*="#"]:not([href="#"])').each(function(index, item){
                    let href = $(item).attr('href');
                    let top = $(href).offset().top;
                    offsetArr.push(top);
                });
                offsetArr.push($(document).height());
            }
            handleOffsetValue();
            $(window).scroll(function(e){
                let scrollTop = $(window).scrollTop();
                for(let i=0;i<offsetArr.length-1;i++){
                    if(scrollTop >= offsetArr[i] && scrollTop <= offsetArr[i+1]){
                        $('.menu_item').eq(i).addClass('active').siblings().removeClass('active');
                    }
                }
            });
        })();
    </script>
</body>
</html>